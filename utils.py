#1
import re
import random
from typing import Optional, Tuple
from aiogram.types import Message, User

# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Ä–æ–≤–Ω–µ–π –∏ —Ç–∏—Ç—É–ª–æ–≤
LEVELS = [
    {
        "min": 1, "max": 4,
        "emoji": "üî•", "title": "–£–†–û–í–ï–ù–¨ 1: –°–õ–ò–ó–ù–Ø–ö–ò-–û–ë–ï–©–ê–õ–¨–©–ò–ö–ò",
        "nicknames": [
            '¬´‚Äû–ü—Ä–∏–¥—É!‚Äú ‚Äî —Å–∫–∞–∑–∞–ª –∏ —Å–¥–æ—Ö –æ–±–æ—Å—Ä–∞–≤—à–∏—Å—å¬ª',
            '¬´–ì–µ—Ä–æ–π –ø–∏–∑–¥–µ–∂–∞: 100% —Å–ª–æ–≤, 0% —è–≤–∫–∏¬ª',
            '¬´–û–±–µ—â–∞–ª –∫–∞–∫ —Ü–∞—Ä—å, —Å–¥–µ–ª–∞–ª –∫–∞–∫ –º—É—Å–æ—Ä¬ª',
            '¬´–°–ª–æ–≤–æ–±–ª—É–¥ –¥–∏–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–ª–∏–≤–∞¬ª',
            '¬´–ì–æ–≤–Ω–æ, –∑–∞–±—ã–≤—à–µ–µ –ø—Ä–æ –∫–ª—è—Ç–≤—ã¬ª',
        ]
    },
    {
        "min": 5, "max": 9,
        "emoji": "üí©", "title": "–£–†–û–í–ï–ù–¨ 2: –ü–†–ï–î–ê–¢–ï–õ–ò –ë–£–•–õ–ò–ß–ù–û–ì–û –§–†–û–ù–¢–ê",
        "nicknames": [
            '¬´–ò–∑–º–µ–Ω–Ω–∏–∫ –≤–æ–¥–æ—á–Ω–æ–≥–æ –¥–æ–≤–µ—Ä–∏—è¬ª',
            '¬´–î–µ–∑–µ—Ä—Ç–∏—Ä —à–æ—Ç-–≤–æ–π—Å–∫¬ª',
            '¬´–®–∞—É—Ä–º–∞ –≤ –º–∞—Å–∫—Ö–∞–ª–∞—Ç–µ –∏–∑ –≥–æ–≤–Ω–∞¬ª',
            '¬´–ó–∞–≥—É–±–ª–µ–Ω–Ω—ã–π —Ç–æ—Å—Ç –≤ –ø—É—Å—Ç–æ—Ç–µ¬ª',
            '¬´–ü—Ä–æ–±–∫–∞ –∏–∑ –∂–æ–ø—ã —Ç—Ä–µ–∑–≤–µ–Ω–Ω–∏–∫–∞¬ª',
        ]
    },
    {
        "min": 10, "max": 14,
        "emoji": "‚ò†Ô∏è", "title": "–£–†–û–í–ï–ù–¨ 3: –ö–õ–û–£–ù–´ –ë–ï–ó –¶–ò–†–ö–ê",
        "nicknames": [
            '¬´–ö–ª–æ—É–Ω-–Ω–µ–≤–∏–¥–∏–º–∫–∞ (–æ–±–µ—â–∞–ª —Ñ–æ–∫—É—Å, –Ω–æ –æ–±–æ—Å—Ä–∞–ª—Å—è)¬ª',
            '¬´–®—É—Ç –≥–æ—Ä–æ—Ö–æ–≤—ã–π —Å –ø—Ä–æ—Ç—É—Ö—à–∏–º–∏ –∞–Ω–µ–∫–¥–æ—Ç–∞–º–∏¬ª',
            '¬´–£—ë–±–æ–∫, –æ—Å—Ç–∞–≤–∏–≤—à–∏–π –Ω–∞—Å –±–µ–∑ —Å–º–µ—Ö–∞¬ª',
            '¬´–°–∫–æ–º–æ—Ä–æ—Ö —Å—Ä–∞–Ω—ã—Ö –æ–ø—Ä–∞–≤–¥–∞–Ω–∏–π¬ª',
            '¬´–¢–∞–º –≥–¥–µ —Ç—ã —Å–∏–¥–µ–ª —Ç–µ–ø–µ—Ä—å –Ω–∞–±–ª—ë–≤–∞–Ω–æ¬ª',
        ]
    },
    {
        "min": 15, "max": 19,
        "emoji": "ü™ì", "title": "–£–†–û–í–ï–ù–¨ 4: –≠–ü–ò–ß–ï–°–ö–ò–ï –ì–û–í–ù–û–ü–ò–°–¶–´",
        "nicknames": [
            '¬´–°–≤–∏—Ç–æ–∫ –ø—É—Å—Ç—ã—Ö –æ–±–µ—â–∞–Ω–∏–π (—Å–æ–∂–∂—ë–Ω)¬ª',
            '¬´–ü–æ—ç—Ç-–ø–µ—Å—Å–∏–º–∏—Å—Ç: —Å—Ç—Ä–æ—Ñ–∞ ‚Äû–Ω–µ –ø—Ä–∏–¥—É"¬ª',
            '¬´–ë–∞–ª–ª–∞–¥–∞ –æ —Ç—Ä—É—Å–ª–∏–≤–æ–π –º–æ–∫—Ä–∏—Ü–µ¬ª',
            '¬´–†–∏—Ñ–º–æ–ø–ª—ë—Ç –≥–æ–≤–Ω–∞ –∏ –∏–∑–º–µ–Ω—ã¬ª',
            '¬´–ì–æ–º–µ—Ä –ø–∏–∑–¥–µ—Ü–∞ (–ò–ª–∏–∞–¥–∞ –Ω–µ—è–≤–∫–∏)¬ª',
        ]
    },
    {
        "min": 20, "max": 24,
        "emoji": "üß®", "title": "–£–†–û–í–ï–ù–¨ 5: –ú–ê–ù–¨–Ø–ö–ò –ù–ê–®–ï–ì–û –¢–ï–†–ü–ï–ù–ò–Ø",
        "nicknames": [
            '¬´–°–µ—Ä–∏–π–Ω—ã–π —É–±–∏–π—Ü–∞ –ø–ª–∞–Ω–æ–≤¬ª',
            '¬´–î–æ–∫—Ç–æ—Ä –ë–ª–µ–≤–æ—Ç–Ω—ã–π: –≤—Å–∫—Ä—ã–ª –Ω–∞–¥–µ–∂–¥—ã¬ª',
            '¬´–ü—Å–∏—Ö–æ–ø–∞—Ç —Å —Å–∏–Ω–¥—Ä–æ–º–æ–º ‚Äû–∑–∞–±–∏–ª —Ö—É–π"¬ª',
            '¬´–ú–∞–Ω—å—è–∫-–æ–¥–∏–Ω–æ—á–∫–∞: –∂–µ—Ä—Ç–≤–∞ ‚Äî –Ω–∞—à–∞ —Ç—É—Å–æ–≤–∫–∞¬ª',
            '¬´–ì–∞–Ω–Ω–∏–±–∞–ª –±–µ–∑ —Å–º–µ–ª–æ—Å—Ç–∏ (—Å–æ–∂—Ä–∞–ª —Å–ª–æ–≤–æ)¬ª',
        ]
    },
    {
        "min": 25, "max": 29,
        "emoji": "‚ö°", "title": "–£–†–û–í–ï–ù–¨ 6: –ë–û–ì–ò –ò–ó–í–†–ê–©–Å–ù–ù–û–ì–û –ü–ò–ó–î–ï–ñ–ê",
        "nicknames": [
            '¬´–ó–µ–≤—Å-–ø–∏–∑–¥–∞–±–æ–ª: –º–µ—Ç–Ω—É–ª –º–æ–ª—á–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –º–æ–ª–Ω–∏–∏¬ª',
            '¬´–û–¥–∏–Ω-–æ–¥–Ω–æ–≥–ª–∞–∑—ã–π (–Ω–µ —É–≤–∏–¥–µ–ª –Ω–∞—à —á–∞—Ç)¬ª',
            '¬´–ê–Ω—É–±–∏—Å ‚Äî –≤–∑–≤–µ—Å–∏–ª —Ç–≤–æ—é –¥—É—à—É –∏ —Å–±–ª–µ–≤–∞–ª¬ª',
            '¬´–õ–æ–∫–∏ –ª–∂–∏: —Å–ª–∏–ª, –∫–∞–∫ –∏—Å—Ç–∏–Ω–Ω—ã–π —Ç—Ä–æ–ª–ª—å¬ª',
            '¬´–ë–∞—Å—Ç–µ—Ç-—Å—Ç–µ—Ä–≤–∞: –Ω–∞—Å—Å–∞–ª–∞ –Ω–∞ –Ω–∞—à–∏ –Ω–∞–¥–µ–∂–¥—ã¬ª',
        ]
    },
    {
        "min": 30, "max": 34,
        "emoji": "üåë", "title": "–£–†–û–í–ï–ù–¨ 7: –ö–û–°–ú–ò–ß–ï–°–ö–ò–ï –ú–£–î–ê–ö–ò",
        "nicknames": [
            '¬´–ß—ë—Ä–Ω–∞—è –¥—ã—Ä–∞ –æ–±–µ—â–∞–Ω–∏–π (–ø–æ–≥–ª–æ—Ç–∏–ª–∞ 5 –ª–∏—Ç—Ä–æ–≤ –ø–∏–≤–∞)¬ª',
            '¬´–°–ø—É—Ç–Ω–∏–∫ –≤—Ä–∞–Ω—å—è –Ω–∞ –æ—Ä–±–∏—Ç–µ –∏–≥–Ω–æ—Ä–∞¬ª',
            '¬´–ò–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω: ‚Äû–ë—ã–ª–æ –¥–µ–ª–æ... –Ω–æ —É–ª–µ—Ç–µ–ª"¬ª',
            '¬´–ö–æ–º–µ—Ç–Ω—ã–π —Ö–≤–æ—Å—Ç —Ç–≤–æ–µ–≥–æ –ø–æ–∑–æ—Ä–∞¬ª',
            '¬´–¢—É–º–∞–Ω–Ω–æ—Å—Ç—å: —Ç–∞–º, –≥–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–≤–æ–µ —Ç–µ–ª–æ¬ª',
        ]
    },
    {
        "min": 35, "max": 39,
        "emoji": "üî™", "title": "–£–†–û–í–ï–ù–¨ 8: –ü–ê–õ–ê–ß–ò –ù–ê–®–ï–ì–û –í–ï–ß–ï–†–ê",
        "nicknames": [
            '¬´–≠–∫–∑–µ–∫—É—Ç–æ—Ä: –∫–∞–∑–Ω–∏–ª –Ω–∞—à –Ω–∞—Å—Ç—Ä–æ–π¬ª',
            '¬´–î—É—à–∏—Ç–µ–ª—å —Å–º–µ—Ö–∞ (—Ä—É–∫–∏ ‚Äî —Ç–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è)¬ª',
            '¬´–ü–∞–ª–∞—á-–º–æ–ª—á—É–Ω: –≥–∏–ª—å–æ—Ç–∏–Ω–∞ –¥–ª—è –ø–ª–∞–Ω–æ–≤¬ª',
            '¬´–°–∞–¥–∏—Å—Ç —Ç–∏—à–∏–Ω—ã: –∑–∞–º—É—á–∏–ª –æ–∂–∏–¥–∞–Ω–∏–µ–º¬ª',
            '¬´–ì—Ä–æ–±–æ–≤—â–∏–∫ –≤–µ—Å–µ–ª—å—è (–∑–∞–∫–æ–ø–∞–ª —Ç—É—Å—É)¬ª',
        ]
    },
    {
        "min": 40, "max": 44,
        "emoji": "üíé", "title": "–£–†–û–í–ï–ù–¨ 9: –ê–ë–°–û–õ–Æ–¢–ù–´–ï –£–†–û–î–´ –°–ò–°–¢–ï–ú–´",
        "nicknames": [
            '¬´–ò–¥–µ–∞–ª—å–Ω—ã–π —à—Ç–æ—Ä–º –ø–∏–∑–¥–µ—Ü–∞: —Å–ª–∏–≤–∞–ª —Ç–∞–∫, —á—Ç–æ —Ä–∞–∑—ä–µ–±–∞–ª–æ –ø–æ–ª–º–∏—Ä–∞¬ª',
            '¬´–≠—Ç–∞–ª–æ–Ω–Ω–æ–µ –≥–æ–≤–Ω–æ –≤ –≤–∞–∫—É—É–º–µ —Å–æ–≤–µ—Å—Ç–∏¬ª',
            '¬´–ö—Ä–∏—Å—Ç–∞–ª–ª –ª–∂–∏ (–æ–≥—Ä–∞–Ω–∫–∞ ‚Äû–Ω–∞—Ö—É–π –Ω—É–∂–µ–Ω")¬ª',
            '¬´–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤–∞—è –∂–æ–ø–∞: 100 –∫–∞—Ä–∞—Ç –±–µ—Å—Å—Ç—ã–¥—Å—Ç–≤–∞¬ª',
            '¬´–ê–ª–º–∞–∑–Ω—ã–π —á–ª–µ–Ω: —Ç–≤—ë—Ä–¥ –≤ –æ–±–µ—â–∞–Ω–∏—è—Ö, –≤–∏—Å–∏—Ç –∫–æ–≥–¥–∞ –Ω–∞–¥–æ¬ª',
        ]
    },
    {
        "min": 45, "max": 1000,
        "emoji": "‚òØÔ∏è", "title": "–£–†–û–í–ï–ù–¨ 10: –î–ù–û –ú–ê–¢–ï–†–ò–ù–°–ö–û–ì–û –ü–†–û–ö–õ–Ø–¢–ò–Ø",
        "nicknames": [
            '¬´–°—ã–Ω —à–ª—é—Ö–∏ –±–µ–∑–æ—Ç—Ü–æ–≤—â–∏–Ω—ã (—Ç–µ–ø–µ—Ä—å —è —Ç–≤–æ–π –±–∞—Ç—è)¬ª',
            '¬´–ë–µ—Å–±–∞—à–µ–Ω–Ω—ã–π —É—ë–±–æ–∫: –∑–∞ —Ä—É–ª—ë–º –æ—Ç–º–∞–∑–æ–∫¬ª',
            '¬´–ü–∏–∑–¥–∞ –∞–±—å—é–∑–∞: —Å–ª–æ–º–∞–ª –Ω–∞—à–∏ –æ–∂–∏–¥–∞–Ω–∏—è¬ª',
            '¬´–ö–∞—Ä–º–∞-—É–±–∏–π—Ü–∞: –≤–µ—Ä–Ω—ë—Ç—Å—è —Ç—Ä–æ–π–Ω—ã–º –ø–∏–∑–¥–µ—Ü–æ–º¬ª',
            '¬´–ü—Ä–∏–≥–æ–≤–æ—Ä: –ü–û–ó–û–† –ù–ê –í–ï–ö √ó —Ñ–æ—Ç–æ –≤ —á–∞—Ç–µ –Ω–∞ —É–Ω–∏—Ç–∞–∑–µ¬ª',
        ]
    },
]

# –§—Ä–∞–∑—ã –¥–ª—è –∞–≤—Ç–æ—Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ –ø—Ä–æ–≥—É–ª–∞
REMOVE_ABSENCE_PHRASES = [
    "‚úÖ –ü—Ä–æ—ë–± –ø—Ä–æ—â—ë–Ω {username}—É! \n –ú–æ–∂–µ—à—å –≤—ã–¥–æ—Ö–Ω—É—Ç—å, –Ω–æ –æ—á–∫–æ –Ω–µ —Ä–∞—Å—Å–ª–∞–±–ª—è–π! üò§",
    "‚úÖ {username} –ø–æ–ª—É—á–∏–ª –≤—Ç–æ—Ä–æ–π —à–∞–Ω—Å! \n –ù–µ –ø—Ä–æ–µ–±–∏—Å—å —Å–Ω–æ–≤–∞, –∞ —Ç–æ —Ö—É–∂–µ –±—É–¥–µ—Ç! ü§ù",
    "‚úÖ –°–Ω—è—Ç –ø—Ä–æ–≥—É–ª —Å {username}! \n –ù–æ –º—ã –≤—Å—ë –ø–æ–º–Ω–∏–º, —Ç–∞–∫ —á—Ç–æ –Ω–µ –Ω–∞–∫–æ—Å—è—á—å! üëÄ",
    "‚úÖ {username} –ø—Ä–æ—â—ë–Ω! \n –ù–æ —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º–æ–∂–Ω–æ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è! ‚ö†Ô∏è",
    "‚úÖ –ü—Ä–æ–≥—É–ª —Å–Ω—è—Ç —Å {username}! \n –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –≥–æ—Ç–æ–≤—å –æ—á–∫–æ! üòà",
    "‚úÖ {username} –ø–æ–ª—É—á–∏–ª –ø–æ–º–∏–ª–æ–≤–∞–Ω–∏–µ! \n –ò—Å–ø–æ–ª—å–∑—É–π –º—É–¥—Ä–æ! üß†",
    "‚úÖ –°–Ω—è—Ç –ø—Ä–æ–≥—É–ª —Å {username}! \n –ó–∞–ø–æ–º–Ω–∏ –∫—Ç–æ —Ç–µ–±—è –∫–æ—Ä–º–∏—Ç, —É–±–ª—é–¥–æ–∫! üôè",
    "‚úÖ {username} –ø—Ä–æ—â—ë–Ω! \n –ù–æ –º—ã —É–∂–µ –≥–æ—Ç–æ–≤–∏–º—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø—Ä–æ—ë–±—É! üëÅÔ∏è",
    "‚úÖ –ü—Ä–æ–≥—É–ª —Å–Ω—è—Ç —Å {username}!  \n –ù–µ –ø–æ–¥–≤–æ–¥–∏ –∫–æ–º–∞–Ω–¥—É! üí™",
    "‚úÖ {username} –ø–æ–ª—É—á–∏–ª —à–∞–Ω—Å –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!  \n –ù–∏–∫—Ç–æ, –∫–æ–Ω–µ—á–Ω–æ, –≤ —Ç–µ–±—è –Ω–µ –≤–µ—Ä–∏—Ç! üéØ",
    "‚úÖ –í–û–õ–®–ï–ë–°–¢–í–û –°–õ–£–ß–ò–õ–û–°–¨! \n @username –≤—ã–ª–µ–ø–∏–ª–∏ –∏–∑ –≥–æ–≤–Ω–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–µ–ª–æ–≤–µ–∫–∞! \n –°–ª–µ–¥—É—é—â–∏–π —Å–ª–∏–≤ = —Ä–∏—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ–∂–∂–µ–Ω–∏–µ –µ–≥–æ —Ñ–æ—Ç–æ!",
    "‚úÖ –ü–†–ò–ö–ê–ó ‚Ññ 666: \n @username –∞–º–Ω–∏—Å—Ç–∏—Ä–æ–≤–∞–Ω —É—Å–ª–æ–≤–Ω–æ-–¥–æ—Å—Ä–æ—á–Ω–æ! \n –ù–æ –ø–æ–º–Ω–∏, –º—Ä–∞–∑—å: \n –¢—ã —Ö–æ–¥–∏—à—å –ø–æ –ª–µ–∑–≤–∏—é; \n –¢–≤–æ–π —Å—Ç–∞—Ç—É—Å ‚Äî ‚Äû–ø–æ–ª—É—á–µ–ª–æ–≤–µ–∫‚Äú; \n \n –û–¥–∏–Ω –ø—Ä–æ–≥—É–ª ‚Äî –∏ –º—ã —Å–æ–ª—å—ë–º —Ç–≤–æ–∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Å –º–∞–º–æ–π –≤ —á–∞—Ç! \n –î–µ—Ä–∂–∏ –±—É—Ç—ã–ª–∫—É –∫—Ä–µ–ø—á–µ, —á–µ–º —Å–≤–æ—ë —Å–ª–æ–≤–æ."
]

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø—Ä–æ–≥—É–ª–æ–≤
def get_level(absences: int):
    for i, level in enumerate(LEVELS):
        if level["min"] <= absences <= level["max"]:
            return i, level
    return None, None

def extract_user_from_message(message: Message) -> Optional[Tuple[str, str]]:
    # ... (–æ—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    if message.reply_to_message and message.reply_to_message.from_user:
        user = message.reply_to_message.from_user
        return str(user.id), user.username or user.first_name or str(user.id)
    text = message.text or message.caption or ""
    username_match = re.search(r'@(\w+)', text)
    if username_match:
        username = username_match.group(1)
        return username, username
    return None

def format_remove_absence_message(username: str, success: bool) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —Å–Ω—è—Ç–∏–∏ –ø—Ä–æ–≥—É–ª–∞"""
    if success:
        return random.choice(REMOVE_ABSENCE_PHRASES).format(username=username)
    else:
        return f"‚ÑπÔ∏è –ê {username} —á–∏—â–µ –Ω–µ —Å–¥–µ–ª–∞—à–µ—å - –ø—Ä–æ–≥—É–ª–æ–≤ –∏ —Ç–∞–∫ –Ω–µ—Ç!"

def format_stats_by_levels(stats: dict) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —É—Ä–æ–≤–Ω—è–º –∏ —Ç–∏—Ç—É–ª–∞–º"""
    levels_users = {i: [] for i in range(len(LEVELS))}
    for user_id, absences in stats.items():
        if absences < 1:
            continue
        idx, level = get_level(absences)
        if idx is not None:
            nickname = random.choice(level["nicknames"])
            levels_users[idx].append((user_id, absences, nickname))
    result = []
    for idx, level in enumerate(LEVELS):
        users = levels_users[idx]
        if not users:
            continue
        result.append(f"{level['emoji']} {level['title']}")
        for user_id, absences, nickname in users:
            result.append(f"@{user_id} ‚Äî {nickname} ({absences} –ø—Ä–æ–≥—É–ª–æ–≤)")
        result.append("")
    if not result:
        return "–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ–µ–±–∞–ª —Ç—É—Å–∏—á! üéâ"
    return "\n".join(result)

#def format_absence_message(username: str, absences: int) -> str:
#    idx, level = get_level(absences)
#    if level:
#        nickname = random.choice(level["nicknames"])
#        return f"@{username} ‚Äî –ë–õ–Ø–î–¨, –¢–´ –û–ë–ï–©–ê–õ! –¢–ï–ü–ï–†–¨ –¢–´ {nickname} ({absences} –ø—Ä–æ–≥—É–ª–æ–≤). –ü–ò–ó–î–´ –ñ–î–ò –í –õ–ò–ß–ö–£ + 1 –®–û–¢ –í –î–û–õ–ì!"
#    else:
#        return f"@{username} —Ç–µ–ø–µ—Ä—å {absences} –ø—Ä–æ–≥—É–ª(–∞/–æ–≤)"

def format_absence_message(username: str, absences: int) -> str:
    idx, level = get_level(absences)
    if level:
        phrase = random.choice(EPIC_ABSENCE_PHRASES)
        return phrase.replace("@username", f"@{username}")
    else:
        return f"@{username} —Ç–µ–ø–µ—Ä—å {absences} –ø—Ä–æ–≥—É–ª(–∞/–æ–≤)"

def is_admin(user: User) -> bool:
    return True

def get_user_display_name(user: User) -> str:
    if user.username:
        return f"@{user.username}"
    elif user.first_name:
        return user.first_name
    else:
        return str(user.id)
        
def format_user_stats_message(username: str, count: int) -> str:
    idx, level = get_level(count)
    if count == 0:
        return f"@{username} —Ö–æ—Ä–æ—à–∏–π –¥—Ä—É–≥/–¥—Ä—É–≥–∏–Ω—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞–π—Ç–µ—Å—å —Å—É–∫–∞–Ω–∞—Ö! üéâ"
    elif level:
        nickname = random.choice(level["nicknames"])
        return f"@{username} ‚Äî {nickname} ({count} –ø—Ä–æ–≥—É–ª–æ–≤)"
    else:
        return f"@{username} –ø—Ä–æ–µ–±–∞–ª—Å—è {count} —Ä–∞–∑"

EPIC_ABSENCE_PHRASES = [
    "@username ‚Äî –≠–ü–ò–ß–ï–°–ö–ê–Ø –ú–û–ö–†–ò–¶–ê!\n–û–±–µ—â–∞–ª —è–≤–∏—Ç—å—Å—è ‚Äî —Å–¥–æ—Ö –≤ —Å–º—Å.\n–¢–≤–æ—ë –º–µ—Å—Ç–æ –∑–∞–Ω—è–ª —Å—Ç—É–ª —Å –±—É—Ç—ã–ª–∫–æ–π –≤–æ–¥–∫–∏. –û–Ω –Ω–∞–¥—ë–∂–Ω–µ–µ.",
    "–í–ù–ò–ú–ê–ù–ò–ï: @username ‚Äî –ü–†–ï–î–ê–¢–ï–õ–¨ –ê–õ–ö–û–ë–†–ê–¢–°–¢–í–ê!\n–°–ª–∏–ª —Ç—É—Å—É –∫–∞–∫ —Ç—ë–ø–ª—ã–π —Å–æ—Ä—Ç–∏—Ä –≤ –ø–æ–¥–≤–æ—Ä–æ—Ç–Ω–µ.\n–ù–∞–ª–∏–≤–∞–µ–º —Ç–µ–±–µ —à—Ç—Ä–∞—Ñ–Ω–æ–π —à–æ—Ç... –≤ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–∏, —É—ë–±–æ–∫!",
    "@username? –ù–ï–¢, –≠–¢–û –ó–í–£–ö –°–†–ê–í–ù–ï–í–®–ï–ô –¢–£–®–ò!\n–¢—ã –æ–±–æ—Å—Ä–∞–ª –¥–æ–≤–µ—Ä–∏–µ, –∫–∞–∫ –±–æ–º–∂ –æ–±–æ—Å—Ä–∞–ª –ø–æ–¥–≤–∞–ª.\n–¢–≤–æ–π —Å—Ç–∞—Ç—É—Å: ¬´–ü—Å–∏—Ö–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä—å–º–æ –Ω–∞ –Ω–æ–∂–∫–∞—Ö¬ª.",
    "–ß–£–î–û: @username –ò–°–ß–ï–ó –ò–ó –†–ï–ê–õ–¨–ù–û–°–¢–ò!\n–ù–æ –≤–æ–Ω—å –ª–∂–∏ –æ—Å—Ç–∞–ª–∞—Å—å.\n–Ø–≤–∫–∞: 0%. –°–æ–≤–µ—Å—Ç—å: -100%. –£–≤–∞–∂–µ–Ω–∏–µ: —Å–æ–∂–∂–µ–Ω–æ.",
    "@username ‚Äî –ì–û–í–ù–Ø–ù–´–ô –§–ï–ù–û–ú–ï–ù!\n–ü–æ–æ–±–µ—â–∞–ª –∫–∞–∫ –ß–µ –ì–µ–≤–∞—Ä–∞ ‚Äî —Å–ª–∏–ª—Å—è –∫–∞–∫ —à–∞—É—Ä–º–∞ –≤ —Ç—É—Ö–ª–æ–º —Å–æ—É—Å–µ.\n–¢–µ–ø–µ—Ä—å —Ç—ã –ø–µ—Ä—Å–æ–Ω–∞ –Ω–æ–Ω-–≥—Ä–∞—Ç–∞ (–∏ –Ω–æ–Ω-–∞–ª–∫–æ–≥–æ–ª–∏–∫–∞).",
    "–ù–ê–£–ß–ù–û–ï –û–¢–ö–†–´–¢–ò–ï:\n@username —Å–æ–∑–¥–∞–ª —á—ë—Ä–Ω—É—é –¥—ã—Ä—É —Ç–∞–º, –≥–¥–µ –¥–æ–ª–∂–µ–Ω –±—ã–ª –±—ã—Ç—å —á–µ–ª–æ–≤–µ–∫!\n–ó–∞–∫–æ–Ω—ã —Ñ–∏–∑–∏–∫–∏: —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –ó–∞–∫–æ–Ω—ã –±—Ä–∞—Ç—Å—Ç–≤–∞: —Ä–∞—Å—Ç–æ–ø—Ç–∞–Ω—ã.",
    "@username ‚Äî –®–ï–î–ï–í–† –¢–†–£–°–û–°–¢–ò!\n–¢–≤–æ—è –Ω–µ—è–≤–∫–∞ –∫—Ä–∏—á–∏—Ç: ¬´–Ø ‚Äî –æ–≤–æ—â —Å –≥–Ω–∏–ª–æ–π —Å–µ—Ä–¥—Ü–µ–≤–∏–Ω–æ–π!¬ª\n–ü—Ä–∏–º–∏ –Ω–∞—à –ø–ª–µ–≤–æ–∫ –≤ —Ç–≤–æ—é —Ü–∏—Ñ—Ä–æ–≤—É—é –º–æ–≥–∏–ª—É!",
    "–ü–†–ò–ì–û–í–û–†: @username ‚Äî –í–´–°–ï–ö–£–¢ –ú–ï–ú–ê–ú–ò!\n–¢–≤–æ—è –ª–æ–∂—å ‚Äî —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è —Ç—ã—Å—è—á–∏ —É–Ω–∏–∑–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç–∏–∫–µ—Ä–æ–≤.\n–ì–æ—Ç–æ–≤—å –∂–æ–ø—É: –ø–µ—Ä–≤—ã–π –≥–∏—Ñ —Å –ø–ª–∞—á—É—â–∏–º –∫–ª–æ—É–Ω–æ–º —É–∂–µ –ª–µ—Ç–∏—Ç!",
    "@username, –ú–´ –ó–ê –¢–û–ë–û–ô –ù–ï –ó–ê–°–ö–£–ß–ê–ï–ú!\n–¢–≤–æ—ë –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ —É–∫—Ä–∞—Å–∏–ª–∏ –¥–≤–µ –±—É—Ç—ã–ª–∫–∏ —Ç–µ–∫–∏–ª—ã –∏ –ø–∞–∫–µ—Ç —á–∏–ø—Å–æ–≤.\n–û–Ω–∏ –Ω–µ –ø—Ä–µ–¥–∞–¥—É—Ç. –ê —Ç—ã ‚Äî –≥–æ–≤–Ω–æ –≤ –±–æ–∫–∞–ª–µ –≤–∏–Ω–∞.",
    "–û–ë–™–Ø–í–õ–ï–ù–ò–ï:\n–¢—Ä—É–ø @username –≤—ã–±—Ä–æ—à–µ–Ω –Ω–∞ –ø–æ–º–æ–π–∫—É –∏—Å—Ç–æ—Ä–∏–∏!\n–ü—Ä–∏—á–∏–Ω–∞ —Å–º–µ—Ä—Ç–∏: –°–ü–ì–° (–°–∏–Ω–¥—Ä–æ–º –ü–æ–¥–∑–∞–ª—É–ø–Ω–æ–π –ì–Ω–∏–ª–æ–π –°–æ–≤–µ—Å—Ç–∏).\n–ü–æ—Ö–æ—Ä–æ–Ω—ã: –≤ —á–∞—Ç–µ, –ø–æ–¥ —Å–º–µ—Ö –∏ –∑–≤–æ–Ω –±–æ–∫–∞–ª–æ–≤."
    "@{username} ‚Äî –ë–õ–Ø–î–¨, –¢–´ –û–ë–ï–©–ê–õ! –¢–ï–ü–ï–†–¨ –¢–´ {nickname} ({absences} –ø—Ä–æ–≥—É–ª–æ–≤). –ü–ò–ó–î–´ –ñ–î–ò –í –õ–ò–ß–ö–£ + 1 –®–û–¢ –í –î–û–õ–ì!"
]